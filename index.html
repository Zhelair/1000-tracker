<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–°—á—ë—Ç—á–∏–∫ –¥–ª—è ¬´–¢—ã—Å—è—á–∏¬ª</title>
  <link rel="stylesheet" href="./styles.css" />
  <script>
    // GitHub Pages gotcha: opening /repo (without trailing slash) makes relative scripts resolve from domain root.
    // Auto-fix by redirecting to /repo/.
    (function () {
      const p = location.pathname;
      const last = p.split('/').filter(Boolean).slice(-1)[0] || '';
      const looksLikeDir = last && !last.includes('.');
      if (looksLikeDir && !p.endsWith('/')) {
        location.replace(p + '/' + location.search + location.hash);
      }
    })();
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script defer src="./supabase.js"></script>
  <script defer src="./app.js"></script>
</head>
<body>
  <div class="wrap">
    <header class="topbar">
      <div class="brand">
        <div class="title">–°—á—ë—Ç—á–∏–∫ –¥–ª—è –∏–≥—Ä—ã ¬´–¢—ã—Å—è—á–∞¬ª</div>
        <div class="subtitle">–ë–µ–∑ —Å–ø–æ—Ä–æ–≤. –¢–æ–ª—å–∫–æ —Å—á—ë—Ç.</div>
      </div>
      <div class="status" id="statusPill">offline</div>
    </header>

    <!-- HOME -->
    <section class="card" id="viewHome">
      <h2>–ö–æ–º–Ω–∞—Ç–∞</h2>
      <div class="grid2">
        <label class="field">
          <span>–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã</span>
          <input id="roomCode" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: family-2026" autocomplete="off" />
          <small class="hint">–°–æ–≤–µ—Ç: —Å–¥–µ–ª–∞–π –∫–æ–¥ –ø–æ–¥–ª–∏–Ω–Ω–µ–µ, —á—Ç–æ–±—ã –Ω–∏–∫—Ç–æ —Å–ª—É—á–∞–π–Ω–æ –Ω–µ –≤–ª–µ–∑.</small>
        </label>

        <label class="field">
          <span>–ö—Ç–æ –≤—ã</span>
          <select id="meSelect">
            <option value="banker">–ë–∞–Ω–∫–∏—Ä</option>
            <option value="risk">–†–∏—Å–∫–æ–≤—ã–π</option>
            <option value="calm">–ù–µ–≤–æ–∑–º—É—Ç–∏–º—ã–π</option>
          </select>
          <small class="hint">–ù–∞ –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π —Ä–æ–ª—å.</small>
        </label>
      </div>

      <div class="row">
        <button class="btn primary" id="btnJoin">–í–æ–π—Ç–∏ / –°–æ–∑–¥–∞—Ç—å</button>
        <button class="btn" id="btnCopyLink">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
      </div>

      <div class="recent" id="recentWrap" style="display:none;">
        <div class="recentHead">
          <div class="muted">–ù–µ–¥–∞–≤–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã</div>
          <button class="btn tiny" id="btnClearRecent" type="button">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
        <div class="recentList" id="recentList"></div>
      </div>
    </section>

    <!-- ROOM -->
    <section id="viewRoom" style="display:none;">
      <div class="roomHead card">
        <div class="roomMeta">
          <div class="roomCode">–ö–æ–º–Ω–∞—Ç–∞: <span id="roomCodeLabel">‚Äî</span></div>
          <div class="muted">–í—ã: <span id="meLabel">‚Äî</span> ‚Ä¢ <span id="lockLabel">üîì –ø—Ä–∞–≤–∏–ª–∞ –Ω–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã</span></div>
        </div>
        <div class="roomActions">
          <button class="btn danger" id="btnResetGame" title="–°–±—Ä–æ—Å–∏—Ç—å —Ç–µ–∫—É—â—É—é –∏–≥—Ä—É (–Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é –ø–∞—Ä—Ç–∏—é)">–°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É</button>
          <button class="btn" id="btnShare">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
          <button class="btn" id="btnExit">–í—ã–π—Ç–∏</button>
        </div>
      </div>

      <nav class="tabs card">
        <button class="tab active" data-tab="rules">–ü—Ä–∞–≤–∏–ª–∞</button>
        <button class="tab" data-tab="score">–°—á—ë—Ç</button>
        <button class="tab" data-tab="history">–ò—Å—Ç–æ—Ä–∏—è</button>
        <button class="tab" data-tab="graph">–ì—Ä–∞—Ñ–∏–∫</button>
      </nav>

      <!-- RULES TAB -->
      <section class="card tabPanel" id="tab-rules">
        <div class="panelHead">
          <h2>–ü—Ä–∞–≤–∏–ª–∞</h2>
          <button class="btn tiny" id="btnSources" type="button">–ò—Å—Ç–æ—á–Ω–∏–∫–∏</button>
        </div>

        <div class="agreeBox">
          <div class="agreeTitle">–°–æ–≥–ª–∞—Å–∏–µ (—á—Ç–æ–±—ã –ø–æ—Ç–æ–º –Ω–µ –±—ã–ª–æ ¬´—è —Ç–∞–∫ –Ω–µ –¥–æ–≥–æ–≤–∞—Ä–∏–≤–∞–ª—Å—è¬ª)</div>
          <div class="agreeGrid" id="agreeGrid"></div>
        </div>

        <details class="details">
          <summary>–®–ø–∞—Ä–≥–∞–ª–∫–∞ (–∫–ª–∞—Å—Å–∏–∫–∞)</summary>
          <div class="cheat">
            <div class="cheatBlock">
              <div class="cheatH">–û—á–∫–∏ –∫–∞—Ä—Ç</div>
              <div class="chips">
                <span class="chip">–¢—É–∑ ‚Äî 11</span>
                <span class="chip">10 ‚Äî 10</span>
                <span class="chip">–ö–æ—Ä–æ–ª—å ‚Äî 4</span>
                <span class="chip">–î–∞–º–∞ ‚Äî 3</span>
                <span class="chip">–í–∞–ª–µ—Ç ‚Äî 2</span>
                <span class="chip">–î–µ–≤—è—Ç–∫–∞ –∏ –Ω–∏–∂–µ ‚Äî 0</span>
              </div>
            </div>

            <div class="cheatBlock">
              <div class="cheatH">–ú–∞—Ä—å—è–∂–∏ (–∫–æ—Ä–æ–ª—å + –¥–∞–º–∞ –º–∞—Å—Ç–∏)</div>
              <div class="chips">
                <span class="chip">‚ô• 100</span>
                <span class="chip">‚ô¶ 80</span>
                <span class="chip">‚ô£ 60</span>
                <span class="chip">‚ô† 40</span>
              </div>
            </div>

            <div class="cheatBlock">
              <div class="cheatH">–ó–∞–∫–∞–∑ (–∫–æ–Ω—Ç—Ä–∞–∫—Ç)</div>
              <div class="muted">
                –ü–æ–±–µ–¥–∏—Ç–µ–ª—å —Ç–æ—Ä–≥–æ–≤ –æ–±—ä—è–≤–ª—è–µ—Ç –∑–∞–∫–∞–∑. –í—ã–ø–æ–ª–Ω–∏–ª ‚Äî –ø—Ä–∏–±–∞–≤–ª—è–µ–º –∑–∞–∫–∞–∑. –ù–µ –≤—ã–ø–æ–ª–Ω–∏–ª ‚Äî –≤—ã—á–∏—Ç–∞–µ–º –∑–∞–∫–∞–∑.
              </div>
            </div>

            <div class="cheatBlock">
              <div class="cheatH">–í–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ</div>
              <div class="muted">–≠—Ç–æ –Ω–µ ‚Äú–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º‚Äù, –∞ —Ç–æ, —á—Ç–æ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–æ–º–∞. –í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–∫–ª—é—á–∏—Ç—å.</div>
            </div>
          </div>
        </details>

        <div class="variants">
          <div class="variantsHead">
            <div>
              <div class="cheatH">–í–∞—Ä–∏–∞–Ω—Ç—ã (–ø–æ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏)</div>
              <div class="muted">–ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç–µ, –∏ –≤—Å—ë —Å—Ç–∞–Ω–µ—Ç –ø—Ä–æ—â–µ.</div>
            </div>
            <label class="toggle">
              <input type="checkbox" id="optVariantsOn" />
              <span>–ò—Å–ø–æ–ª—å–∑—É–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã</span>
            </label>
          </div>

          <div id="variantsBody">
            <div class="ruleRow">
              <div>
                <div class="rTitle">–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –æ—á–∫–æ–≤</div>
                <div class="muted">–ï—Å–ª–∏ —É –≤–∞—Å –ø—Ä–∏–Ω—è—Ç–æ –æ–∫—Ä—É–≥–ª—è—Ç—å —É ‚Äú–Ω–µ-–∑–∞–∫–∞–∑—á–∏–∫–æ–≤‚Äù.</div>
              </div>
              <select id="optRounding">
                <option value="none">–ë–µ–∑ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è</option>
                <option value="to5">–î–æ 5</option>
                <option value="to10_5up">–î–æ 10 (5 –≤–≤–µ—Ä—Ö)</option>
              </select>
            </div>

            <div class="ruleRow">
              <div>
                <div class="rTitle">–ë–æ–ª—Ç—ã</div>
                <div class="muted">0 –≤–∑—è—Ç–æ–∫ = –±–æ–ª—Ç; 3 –±–æ–ª—Ç–∞ = —à—Ç—Ä–∞—Ñ.</div>
              </div>
              <label class="toggle">
                <input type="checkbox" id="optBoltsOn" />
                <span>–í–∫–ª</span>
              </label>
            </div>

            <div class="ruleRow">
              <div>
                <div class="rTitle">–®—Ç—Ä–∞—Ñ –∑–∞ 3 –±–æ–ª—Ç–∞</div>
                <div class="muted">–û–±—ã—á–Ω–æ 120.</div>
              </div>
              <input id="optBoltsPenalty" type="number" min="0" step="5" value="120" />
            </div>

            <div class="ruleRow">
              <div>
                <div class="rTitle">–°–∞–º–æ—Å–≤–∞–ª 555</div>
                <div class="muted">–†–æ–≤–Ω–æ 555 ‚Üí —Å—á—ë—Ç —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ 0.</div>
              </div>
              <label class="toggle">
                <input type="checkbox" id="opt555On" />
                <span>–í–∫–ª</span>
              </label>
            </div>

            
            <div class="ruleRow">
              <div>
                <div class="rTitle">–ë–æ—á–∫–∞ / 880</div>
                <div class="muted">–ü–æ–∫–∞–∑—ã–≤–∞–µ–º ‚Äú–Ω–∞ –±–æ—á–∫–µ‚Äù (—É–ø—Ä–æ—â—ë–Ω–Ω–æ). –¢–æ—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –º–æ–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å –ø–æ–∑–∂–µ.</div>
              </div>
              <label class="toggle">
                <input type="checkbox" id="optBarrelOn" />
                <span>–í–∫–ª</span>
              </label>
            </div>

            <div class="ruleRow">
              <div>
                <div class="rTitle">–†–æ—Å–ø–∏—Å—å</div>
                <div class="muted">–ó–∞–∫–∞–∑—á–∏–∫ —Å–¥–∞—ë—Ç—Å—è: ‚àí–∑–∞–∫–∞–∑, –æ—Å—Ç–∞–ª—å–Ω—ã–º –ø–æ +–ø–æ–ª–æ–≤–∏–Ω–µ.</div>
              </div>
              <label class="toggle">
                <input type="checkbox" id="optRospisOn" />
                <span>–í–∫–ª</span>
              </label>
            </div>

            <div class="ruleRow">
              <div>
                <div class="rTitle">–ó–æ–ª–æ—Ç–æ–π –∫–æ–Ω</div>
                <div class="muted">–£–¥–≤–æ–µ–Ω–∏–µ –æ—á–∫–æ–≤/–∑–∞–∫–∞–∑–∞ –≤ —ç—Ç–æ–º –∫–æ–Ω–µ (–∫–∞–∫ –æ–ø—Ü–∏—è –≤ —Ñ–æ—Ä–º–µ).</div>
              </div>
              <label class="toggle">
                <input type="checkbox" id="optGoldenOn" />
                <span>–í–∫–ª</span>
              </label>
            </div>
<div class="note">
              –û–ø—Ü–∏–∏ ‚Äú–±–æ—á–∫–∞/880‚Äù, ‚Äú—Ä–æ—Å–ø–∏—Å—å‚Äù, ‚Äú–∑–æ–ª–æ—Ç–æ–π –∫–æ–Ω‚Äù –≤–∫–ª—é—á–∞—é—Ç—Å—è –∑–¥–µ—Å—å. –ï—Å–ª–∏ –º–µ—à–∞—é—Ç ‚Äî –≤—ã–∫–ª—é—á–∏—Ç–µ.
            </div>

            <div class="row">
              <button class="btn primary" id="btnSaveOptions">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã</button>
              <div class="muted" id="optionsHint">–ö–æ–≥–¥–∞ –≤—Å–µ —Å–æ–≥–ª–∞—Å–Ω—ã (3/3) ‚Äî –∏–≥—Ä–∞–µ–º. –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã ‚Äî –Ω–∞—á–Ω—ë—Ç—Å—è –Ω–æ–≤–∞—è –ø–∞—Ä—Ç–∏—è.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- SCORE TAB -->
      <section class="card tabPanel" id="tab-score" style="display:none;">
        <div class="panelHead">
          <h2>–°—á—ë—Ç</h2>
          <div class="muted" id="liveHint">‚Äî</div>
        </div>

        <div class="scoreGrid" id="scoreGrid"></div>

        <div class="divider"></div>

        <h3>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω</h3>
        <div class="formGrid">
          <label class="field">
            <span>–ó–∞–∫–∞–∑—á–∏–∫</span>
            <select id="fBidder"></select>
          </label>

          <label class="field">
            <span>–ó–∞–∫–∞–∑</span>
            <input id="fBid" type="number" step="5" min="0" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä 140" />
          </label>

          <label class="field">
            <span>–†–µ–∑—É–ª—å—Ç–∞—Ç</span>
            <select id="fMade">
              <option value="made">–°—ã–≥—Ä–∞–ª</option>
              <option value="failed">–ù–µ —Å—ã–≥—Ä–∞–ª</option>
            </select>
          </label>

          <div class="row" style="align-items:center; gap:12px; margin-top:6px;">
            <label class="toggle" title="–†–æ—Å–ø–∏—Å—å: –∑–∞–∫–∞–∑—á–∏–∫ —Å–¥–∞—ë—Ç—Å—è (‚àí–∑–∞–∫–∞–∑), –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—É—á–∞—é—Ç –ø–æ +–ø–æ–ª–æ–≤–∏–Ω–µ.">
              <input type="checkbox" id="fRospis" />
              <span>–†–æ—Å–ø–∏—Å—å</span>
            </label>
            <label class="toggle" title="–ó–æ–ª–æ—Ç–æ–π –∫–æ–Ω: —É–¥–≤–æ–∏—Ç—å –æ—á–∫–∏/–∑–∞–∫–∞–∑ –≤ —ç—Ç–æ–º –∫–æ–Ω–µ.">
              <input type="checkbox" id="fGolden" />
              <span>–ó–æ–ª–æ—Ç–æ–π –∫–æ–Ω</span>
            </label>
          </div>
        </div>

        <div class="formGrid3" id="pointsInputs"></div>

        <div class="muted small">–ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã –±–æ–ª—Ç—ã ‚Äî –æ—Ç–º–µ—Ç—å—Ç–µ ‚Äú0 –≤–∑—è—Ç–æ–∫‚Äù.</div>
        <div class="boltRow" id="boltInputs"></div>

        <div class="row">
          <button class="btn primary" id="btnAddRound">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω</button>
          <button class="btn danger" id="btnUndo">–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–Ω</button>
        </div>

        <div class="note">
          –ü–æ–¥—Å–∫–∞–∑–∫–∞: —á—Ç–æ–±—ã —Å–ø–æ—Ä–∏—Ç—å –º–µ–Ω—å—à–µ ‚Äî –≤–≤–æ–¥–∏—Ç–µ –æ—á–∫–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∫–æ–Ω–∞ –∏ –Ω–µ ‚Äú–Ω–∞–∫–∞–ø–ª–∏–≤–∞–π—Ç–µ‚Äù –≤ –≥–æ–ª–æ–≤–µ üòÑ
        </div>
      </section>

      <!-- HISTORY TAB -->
      <section class="card tabPanel" id="tab-history" style="display:none;">
        <div class="panelHead">
          <h2>–ò—Å—Ç–æ—Ä–∏—è</h2>
          <div class="muted">–ö—Ç–æ –≤–Ω—ë—Å –∑–∞–ø–∏—Å—å –∏ –∫–æ–≥–¥–∞ ‚Äî —á—Ç–æ–±—ã ‚Äú–∞ –∫—Ç–æ —ç—Ç–æ –ø–∏—Å–∞–ª?‚Äù –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞–ª–æ—Å—å –≤ –¥–µ—Ç–µ–∫—Ç–∏–≤.</div>
        </div>
        <div id="historyList" class="history"></div>
      </section>

      <!-- GRAPH TAB -->
      <section class="card tabPanel" id="tab-graph" style="display:none;">
        <div class="panelHead">
          <h2>–ì—Ä–∞—Ñ–∏–∫</h2>
          <div class="muted">–ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –∫–æ–Ω–∞–º. –ö–ª–∏–∫ –ø–æ —Ç–æ—á–∫–µ ‚Äî –∏ –≤–∏–¥–Ω–æ, —á—Ç–æ –±—ã–ª–æ –≤ –∏—Å—Ç–æ—Ä–∏–∏.</div>
        </div>
        <canvas id="graph" width="900" height="360" class="graphCanvas"></canvas>
        <div class="muted small" id="graphHint"></div>
      </section>
    </section>


    <!-- WIN MODAL -->
    <div class="modal" id="modalWin" style="display:none;">
      <div class="modalCard">
        <div class="modalHead">
          <div class="modalTitle" id="winTitle">üèÜ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞</div>
          <button class="btn tiny" id="btnWinClose" type="button">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div class="modalBody">
          <div class="muted" id="winBody">‚Äî</div>
          <div class="row" style="margin-top:12px;">
            <button class="btn primary" id="btnWinNew" type="button">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
          </div>
        </div>
      </div>
    </div>


    <!-- SOURCES MODAL -->
    <div class="modal" id="modalSources" style="display:none;">
      <div class="modalCard">
        <div class="modalHead">
          <div class="modalTitle">–ò—Å—Ç–æ—á–Ω–∏–∫–∏</div>
          <button class="btn tiny" id="btnCloseSources" type="button">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div class="modalBody">
          <div class="muted">–°—Å—ã–ª–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ.</div>
          <ul class="links">
            <li><a href="https://minigames.mail.ru/info/article/pravila_tysjacha" target="_blank" rel="noreferrer">Mail.ru ‚Äî –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã ¬´–¢—ã—Å—è—á–∞¬ª</a></li>
            <li><a href="https://www.pagat.com/marriage/1000.html" target="_blank" rel="noreferrer">Pagat ‚Äî 1000 (marriage / contract)</a></li>
            <li><a href="https://en.wikipedia.org/wiki/1000_(card_game)" target="_blank" rel="noreferrer">Wikipedia ‚Äî 1000 (card game)</a></li>
          </ul>
        </div>
      </div>
    </div>

    <footer class="foot muted">
      v8 ‚Ä¢ win+graph+reset ‚Ä¢ 1000
    </footer>
  </div>
  <div id="toast" class="toast" aria-live="polite"></div>
</body>
</html>
